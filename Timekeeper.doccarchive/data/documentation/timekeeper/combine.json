{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"For now, we just covered how to measure timings in an imperative way. If you are using Apple’s Combine framework, using Timekeeper becomes even more fun with the convenience methods it defines on the "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/combine\/publisher"},{"type":"text","text":" type."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Consider the following "},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.apple.com\/documentation\/combine\/future"},{"type":"text","text":" publisher, which emits "},{"type":"codeVoice","code":"\"Hello World!\""},{"type":"text","text":" after one second and then succeeds."}]},{"type":"codeListing","syntax":"swift","code":["let request = Future<String, Error> { promise in","    DispatchQueue.global().asyncAfter(deadline: .now() + 1) {","        promise(.success(\"Hello World!\"))","    }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to measure the duration of the "},{"type":"codeVoice","code":"request"},{"type":"text","text":" from subscription start to completion, you can use the "},{"type":"codeVoice","code":"measure(_:stopOnCompletion:printOnStop:onStop:)"},{"type":"text","text":" operator. It starts the timing when the subscription starts, and stops it on completion of the publisher."}]},{"type":"codeListing","syntax":"swift","code":["request.measure(\"measurement\").sink(...).store(in: &cancellables)","","\/\/ Prints: Timekeeper[default][measurement] - Lap #1: 1.0s - Total: 1.0s"]},{"anchor":"Start-and-stop-Timings-in-a-Stream","level":2,"type":"heading","text":"Start and stop Timings in a Stream"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to manually specify when the timing should start and end, you can use the "},{"type":"codeVoice","code":"measureStart(_:)"},{"type":"text","text":" and "},{"type":"codeVoice","code":"measureStop(_:)"},{"type":"text","text":" operators. Both of them start \/ stop the timing when they receive a value from the upstream publisher. Using "},{"type":"codeVoice","code":"measureLap(_:)"},{"type":"text","text":", you can also add laps to a series of publishers."}]},{"type":"codeListing","syntax":"swift","code":["let uppercase = { (input: String) -> Future<String, Error> in","    Future<String, Error> { promise in","        DispatchQueue.global().asyncAfter(deadline: .now() + 1) {","            promise(.success(input.uppercased()))","        }","    }","}","","Just(())","    .measureStart(\"measurement\")","    .flatMap({ request })","    .measureLap(\"measurement\")","    .flatMap({ uppercase($0) })","    .measureStop(\"measurement\")","    .sink(...)","    .store(in: &cancellables)","","\/\/ Prints: ","\/\/   Timekeeper[default][measurement] - Lap #1: 1.0s","\/\/   Timekeeper[default][measurement] - Lap #1: 2.0s - Total: 2.0s"]},{"anchor":"Work-with-Timings-downstream","level":2,"type":"heading","text":"Work with Timings downstream"},{"type":"paragraph","inlineContent":[{"type":"text","text":"If you want to perform operations on the "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/Timing"},{"type":"text","text":" data in downstream publishers, use the "},{"type":"codeVoice","code":"withMeasureLap(_:)"},{"type":"text","text":" and "},{"type":"codeVoice","code":"measureStop(_:)"},{"type":"text","text":" operators. They publish a "},{"type":"reference","isActive":true,"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/TimingElement"},{"type":"text","text":" to downstream publishers, which is a typealias for the tuple "},{"type":"codeVoice","code":"(Upstream.Output, Timing)"},{"type":"text","text":", where "},{"type":"codeVoice","code":"Output"},{"type":"text","text":" is the output type of the upstream publisher and "},{"type":"codeVoice","code":"Timing"},{"type":"text","text":" the timing which was just modified \/ stopped."}]},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Unlike with the other operators, "},{"type":"codeVoice","code":"withMeasureLap(_:)"},{"type":"text","text":" and "},{"type":"codeVoice","code":"withMeasureStop(_:)"},{"type":"text","text":" fail if no timing was started for the provided "},{"type":"codeVoice","code":"name"},{"type":"text","text":"."}]}]},{"type":"codeListing","syntax":"swift","code":["Just(())","    .measureStart(\"measurement\")","    .flatMap({ request })","    .measureLap(\"measurement\")","    .flatMap({ uppercase($0) })","    .withMeasureStop(\"measurement\")","    .map({ $0.totalDuration })","    .sink(receiveCompletion: { _ in }, receiveValue: { print(\"Total Duration: \\($0)s\") })","    .store(in: &cancellables)"]}]}],"schemaVersion":{"major":0,"minor":1,"patch":0},"sections":[],"variants":[{"paths":["\/documentation\/timekeeper\/combine"],"traits":[{"interfaceLanguage":"swift"}]}],"identifier":{"url":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/Combine","interfaceLanguage":"swift"},"abstract":[{"type":"text","text":"Learn how to measure the duration of one or a sequence of Combine publishers."}],"kind":"article","metadata":{"roleHeading":"Article","title":"Time Combine Operations","role":"article","modules":[{"name":"Timekeeper"}]},"hierarchy":{"paths":[["doc:\/\/Timekeeper\/documentation\/Timekeeper"]]},"seeAlsoSections":[{"title":"Documentation","identifiers":["doc:\/\/Timekeeper\/documentation\/Timekeeper\/Advanced"],"generated":true}],"references":{"doc://Timekeeper/documentation/Timekeeper":{"role":"collection","title":"Timekeeper","abstract":[{"type":"text","text":"Timekeeper is an easy-to-use timing library written in Swift, with support for iOS, tvOS, watchOS and macOS."}],"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper","kind":"symbol","type":"topic","url":"\/documentation\/timekeeper"},"doc://Timekeeper/documentation/Timekeeper/TimingElement":{"role":"symbol","title":"TimingElement","fragments":[{"kind":"keyword","text":"typealias"},{"kind":"text","text":" "},{"kind":"identifier","text":"TimingElement"}],"abstract":[{"type":"text","text":"Type used to represent the combination of a publisher’s output and a timing function’s output."}],"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/TimingElement","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"TimingElement"}],"url":"\/documentation\/timekeeper\/timingelement"},"https://developer.apple.com/documentation/combine/publisher":{"title":"Publisher","titleInlineContent":[{"type":"codeVoice","code":"Publisher"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/combine\/publisher","url":"https:\/\/developer.apple.com\/documentation\/combine\/publisher"},"https://developer.apple.com/documentation/combine/future":{"title":"Future","titleInlineContent":[{"type":"text","text":"Future"}],"type":"link","identifier":"https:\/\/developer.apple.com\/documentation\/combine\/future","url":"https:\/\/developer.apple.com\/documentation\/combine\/future"},"doc://Timekeeper/documentation/Timekeeper/Timing":{"role":"symbol","title":"Timing","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Timing"}],"abstract":[{"type":"text","text":"A struct that describes a timing."}],"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/Timing","kind":"symbol","type":"topic","navigatorTitle":[{"kind":"identifier","text":"Timing"}],"url":"\/documentation\/timekeeper\/timing"},"doc://Timekeeper/documentation/Timekeeper/Advanced":{"role":"collectionGroup","title":"Working with Recorded Timings","abstract":[{"type":"text","text":"Learn how to get timing data for each lap, access raw timings and convenience properties."}],"identifier":"doc:\/\/Timekeeper\/documentation\/Timekeeper\/Advanced","kind":"article","type":"topic","url":"\/documentation\/timekeeper\/advanced"}}}